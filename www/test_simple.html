<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø—Ä–æ—Å—Ç–æ–π –≤–µ—Ä—Å–∏–∏</title>
</head>
<body>
    <h1>–¢–µ—Å—Ç –ø—Ä–æ—Å—Ç–æ–π –≤–µ—Ä—Å–∏–∏ WASM</h1>

    <div>
        <input type="text" id="wordInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ" style="width: 200px;">
        <button onclick="addWord()">–î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ</button>
        <button onclick="checkWord()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ª–æ–≤–æ</button>
        <button onclick="initFilter()">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
        <button onclick="getCount()">–ü–æ–∫–∞–∑–∞—Ç—å —Å—á–µ—Ç</button>
    </div>

    <div>
        <h3>–ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã:</h3>
        <button onclick="testBasic()">–¢–µ—Å—Ç –±–∞–∑–æ–≤—ã—Ö —Å–ª–æ–≤</button>
        <button onclick="testAdded()">–¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤</button>
    </div>

    <div id="result" style="margin: 20px; padding: 10px; border: 1px solid #ccc; min-height: 100px;"></div>

    <script src="text_filter.js"></script>
    <script>
        let check_text, add_bad_word, get_bad_words_count, init_text_filter;

        function initWasm() {
            if (window.Module && window.Module.asm) {
                check_text = Module.cwrap('check_text', 'number', ['string']);
                add_bad_word = Module.cwrap('add_bad_word', null, ['string']);
                get_bad_words_count = Module.cwrap('get_bad_words_count', 'number', []);
                init_text_filter = Module.cwrap('init_text_filter', null, []);
                return true;
            }
            return false;
        }

        function initFilter() {
            if (!initWasm()) {
                showResult('‚ùå WASM –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                return;
            }

            try {
                init_text_filter();
                showResult('‚úÖ –§–∏–ª—å—Ç—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω<br>–ë–∞–∑–æ–≤—ã–µ —Å–ª–æ–≤–∞: –º–∞—Ç, —Å–ø–∞–º, –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ, –Ω–µ–Ω–∞–≤–∏—Å—Ç—å');
            } catch (error) {
                showResult('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        function addWord() {
            const word = document.getElementById('wordInput').value.trim();
            if (!word) {
                showResult('‚ùå –í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ');
                return;
            }

            if (!initWasm()) {
                showResult('‚ùå WASM –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                return;
            }

            try {
                add_bad_word(word);
                const count = get_bad_words_count();
                showResult(`‚úÖ –°–ª–æ–≤–æ "${word}" –¥–æ–±–∞–≤–ª–µ–Ω–æ<br>–í—Å–µ–≥–æ —Å–ª–æ–≤: ${count}`);
            } catch (error) {
                showResult('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        function checkWord() {
            const word = document.getElementById('wordInput').value.trim();
            if (!word) {
                showResult('‚ùå –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏');
                return;
            }

            if (!initWasm()) {
                showResult('‚ùå WASM –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                return;
            }

            try {
                const result = check_text(word);
                const count = get_bad_words_count();
                showResult(`–¢–µ–∫—Å—Ç: "${word}"<br>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${result} (0=—á–∏—Å—Ç—ã–π, 1=–∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–π)<br>–í—Å–µ–≥–æ —Å–ª–æ–≤: ${count}`);
            } catch (error) {
                showResult('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        function getCount() {
            if (!initWasm()) {
                showResult('‚ùå WASM –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                return;
            }

            try {
                const count = get_bad_words_count();
                showResult(`üìä –í—Å–µ–≥–æ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤: ${count}`);
            } catch (error) {
                showResult('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        function testBasic() {
            if (!initWasm()) {
                showResult('‚ùå WASM –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                return;
            }

            try {
                let results = '<strong>–¢–µ—Å—Ç –±–∞–∑–æ–≤—ã—Ö —Å–ª–æ–≤:</strong><br>';
                results += `"—Ç–µ–∫—Å—Ç —Å –º–∞—Ç–æ–º" ‚Üí ${check_text('—Ç–µ–∫—Å—Ç —Å –º–∞—Ç–æ–º')}<br>`;
                results += `"—ç—Ç–æ —Å–ø–∞–º —Å–æ–æ–±—â–µ–Ω–∏–µ" ‚Üí ${check_text('—ç—Ç–æ —Å–ø–∞–º —Å–æ–æ–±—â–µ–Ω–∏–µ')}<br>`;
                results += `"–æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ" ‚Üí ${check_text('–æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ')}<br>`;
                results += `"–Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç" ‚Üí ${check_text('–Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç')}<br>`;

                showResult(results);
            } catch (error) {
                showResult('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        function testAdded() {
            if (!initWasm()) {
                showResult('‚ùå WASM –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                return;
            }

            try {
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–ª–æ–≤–æ
                add_bad_word('—Ç–µ—Å—Ç');

                let results = '<strong>–¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤:</strong><br>';
                results += `"—Ç–µ–∫—Å—Ç —Å —Ç–µ—Å—Ç" ‚Üí ${check_text('—Ç–µ–∫—Å—Ç —Å —Ç–µ—Å—Ç')}<br>`;
                results += `"–ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç" ‚Üí ${check_text('–ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç')}<br>`;
                results += `–í—Å–µ–≥–æ —Å–ª–æ–≤: ${get_bad_words_count()}<br>`;

                showResult(results);
            } catch (error) {
                showResult('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        function showResult(message) {
            document.getElementById('result').innerHTML = message;
        }

        // –ê–≤—Ç–æ-–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        setTimeout(() => {
            if (window.Module && window.Module.asm) {
                showResult('‚úÖ WASM –∑–∞–≥—Ä—É–∂–µ–Ω! –ù–∞–∂–º–∏—Ç–µ "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å"');
            } else {
                showResult('‚ùå WASM –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è');
            }
        }, 1000);
    </script>
    <!-- <script src="loader.js"></script>
    <script src="text_filter.js"></script>
    <script src="moderator.js"></script>
    <script src="main.js"></script> -->
</body>
</html>
