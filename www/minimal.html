<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç</title>
</head>
<body>
    <h1>–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç WASM</h1>

    <div>
        <input type="text" id="testInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ">
        <button onclick="testAdd()">–¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</button>
        <button onclick="testCheck()">–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏</button>
        <button onclick="testCount()">–¢–µ—Å—Ç –ø–æ–¥—Å—á–µ—Ç–∞</button>
        <button onclick="testInit()">–¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</button>
    </div>

    <div id="result" style="margin: 20px; padding: 10px; border: 1px solid #ccc;"></div>

    <script src="text_filter.js"></script>
    <script>
        let check_text, add_bad_word, get_bad_words_count, init_text_filter;

        function initFunctions() {
            if (window.Module && window.Module.asm) {
                check_text = window.Module.cwrap('check_text', 'number', ['string']);
                add_bad_word = window.Module.cwrap('add_bad_word', null, ['string']);
                get_bad_words_count = window.Module.cwrap('get_bad_words_count', 'number', []);
                init_text_filter = window.Module.cwrap('init_text_filter', null, []);
                return true;
            }
            return false;
        }

        function testInit() {
            const resultDiv = document.getElementById('result');

            if (!initFunctions()) {
                resultDiv.innerHTML = '‚ùå WASM –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω';
                return;
            }

            try {
                init_text_filter();
                resultDiv.innerHTML = '‚úÖ –§–∏–ª—å—Ç—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω';
            } catch (error) {
                resultDiv.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + error.message;
            }
        }

        function testAdd() {
            const input = document.getElementById('testInput').value;
            const resultDiv = document.getElementById('result');

            if (!initFunctions()) {
                resultDiv.innerHTML = '‚ùå WASM –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω';
                return;
            }

            try {
                add_bad_word(input);
                const count = get_bad_words_count();
                resultDiv.innerHTML = `‚úÖ –°–ª–æ–≤–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ: "${input}"<br>–í—Å–µ–≥–æ —Å–ª–æ–≤: ${count}`;
            } catch (error) {
                resultDiv.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: ' + error.message;
            }
        }

        function testCheck() {
            const input = document.getElementById('testInput').value;
            const resultDiv = document.getElementById('result');

            if (!initFunctions()) {
                resultDiv.innerHTML = '‚ùå WASM –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω';
                return;
            }

            try {
                const result = check_text(input);
                const count = get_bad_words_count();
                resultDiv.innerHTML = `–¢–µ–∫—Å—Ç: "${input}"<br>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${result} (0=—á–∏—Å—Ç—ã–π, 1=–∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–π)<br>–í—Å–µ–≥–æ —Å–ª–æ–≤ –≤ –±–∞–∑–µ: ${count}`;
            } catch (error) {
                resultDiv.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ' + error.message;
            }
        }

        function testCount() {
            const resultDiv = document.getElementById('result');

            if (!initFunctions()) {
                resultDiv.innerHTML = '‚ùå WASM –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω';
                return;
            }

            try {
                const count = get_bad_words_count();
                resultDiv.innerHTML = `üìä –í—Å–µ–≥–æ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤: ${count}`;
            } catch (error) {
                resultDiv.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥—Å—á–µ—Ç–∞: ' + error.message;
            }
        }

        // –ê–≤—Ç–æ-–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        setTimeout(() => {
            const resultDiv = document.getElementById('result');
            if (window.Module && window.Module.asm) {
                resultDiv.innerHTML = '‚úÖ WASM –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ!<br>–ù–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏"';
            } else {
                resultDiv.innerHTML = '‚ùå WASM –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è';
            }
        }, 2000);
    </script>
</body>
</html>
